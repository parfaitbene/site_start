{% extends 'base.html.twig' %}

{% block stylesheets %}
    <link href="{{ asset('utils/fancybox/jquery.fancybox.min.css') }}" rel="stylesheet" />
{% endblock %}

{% block body %}
    <div class="st-main-header">
        <header>
            {# gallery banner #}
            <section class="st-plx container-fluid st-parallax-container">
                <div class="st-parallax-body view">
                    <img class="st-parallax img-fluid" src="{{ vich_uploader_asset(config, 'bannerFile') }}">
                    <div class="mask rgba-black-strong"></div>
                    <div class="st-parallax-content d-flex align-items-center justify-content-center text-center">
                        <h1 class="sv-name h1-responsive text-uppercase st-font my-2 text-white">Galerie</h1>
                    </div>
                </div>
            </section>
            {# gallery banner #}
        </header>

        <!--Main Layout-->
        <main id="gallery-form-content" class="py-5">
            <div class="container">
                <div class="row mb-5 d-flex justify-content-center">
                    <button class="btn btn-primary mx-1" type="button" data-filter="all">All</button>
                    {% for category in galleryCategories|filter(c => (c.medias|filter(m => m.active)|length > 0)) %}
                    <button class="btn btn-primary mx-1" type="button" data-filter=".cat-{{ category.id }}">{{ category.name|raw }}</button>
                    {% endfor %}
                </div>  
                <div id="gallery-container">
                    <div class="row mb-1">
                        {% if medias|length %}
                            {% for media in medias|filter(m => m.active)|sort((a, b) => a.sequence <=> b.sequence) %}
                                {% if media.type == 'MEDIA' and media.pjFile is defined and media.pj.mimeType not in ['video/mp4', 'video/flv', 'video/mkv'] %}
                                <div class="text-center view zoom mix cat-{{ media.category.id }} col-xs-12 col-sm-6 col-lg-4" data-order="{{ media.sequence }}">
                                    <figure>
                                        <a class="d-block mb-4" data-fancybox="st-gallery" href="{{ vich_uploader_asset(media, 'pjFile') }}" data-caption="{{ media.description|raw }}">
                                            <img class="z-depth-1 img-fluid img-thumb mx-auto" src="{{ vich_uploader_asset(media, 'pjFile')|imagine_filter('gallery_thumbnail') }}" alt="{{ media.pj.name }}">
                                        </a>
                                        <figcaption>
                                            {% if media.name %}<h6>{{ media.name|raw }}</h6>{% endif %}
                                            <a 
                                                {% if media.url %}href="{{ media.url }}"{% endif %} 
                                                {% if media.isUrlNewWindow %}target="_blank"{% endif %} 
                                            >
                                                {{ media.urlText|raw }}
                                            </a>
                                        </figcaption>
                                    </figure>
                                </div>
                                {% else %}
                                <div class="text-center view zoom mix cat-{{ media.category.id }} col-xs-12 col-sm-6 col-lg-4">
                                    <figure>
                                        {% if media.pjFile is defined and media.pj.name %}
                                        <a class="d-block mb-4" data-fancybox="html5-video" href="#{{ media.id }}">
                                            <img class="z-depth-1 img-fluid img-thumb mx-auto" src="{{ vich_uploader_asset(media, 'pjFile')|imagine_filter('gallery_thumbnail') }}" alt="{{ media.pj.name }}">
                                        </a>
                                        {% endif %}
                                        <video 
                                            {% if media.videoLink %}src="{{ media.videoLink }}" 
                                            {% else %}src="{{ vich_uploader_asset(media, 'pjFile') }}" {% endif %} 
                                            width="640" height="320" controls="" id="{{ media.id }}" style="display: none;" class="fancybox-video">
                                        </video>
                                        <figcaption>
                                            {% if media.name %}<h6>{{ media.name|raw }}</h6>{% endif %}
                                            <a 
                                                {% if media.url %}href="{{ media.url }}"{% endif %} 
                                                {% if media.isUrlNewWindow %}target="_blank"{% endif %}
                                            >
                                                {{ media.urlText|raw }}
                                            </a>
                                        </figcaption>
                                    </figure>
                                </div>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            <p class="w-100 my-5 text-center">
                                Aucun média disponible à l'affichage.
                            </p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </main>
    </div>
{% endblock %}

{% block javascripts %}
    <script type="text/javascript" src="{{ asset('utils/fancybox/jquery.fancybox.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('utils/mixitup/mixitup.min.js') }}"></script>
    <script type="text/javascript">
        $(function () {
            var mixer = mixitup($('#gallery-container'));

            $('[data-fancybox="st-gallery"]').fancybox({
                keyboard: true,
                transitionEffect: 'tube',
                buttons: [
                    "zoom",
                    "share",
                    "slideShow",
                    "fullScreen",
                    "download",
                    "thumbs",
                    "close"
                ],
            });
        });
    </script>
{% endblock %}